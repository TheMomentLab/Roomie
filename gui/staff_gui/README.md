# Staff GUI - 직원용 주문 관리 시스템

## 개요

Staff GUI는 RMS(Robot Management System)와 연동되는 직원용 주문 관리 시스템입니다. 이 시스템은 통신을 위해 임시로 만든 스켈레톤 구조로, 실제 RMS 서버와의 WebSocket 통신을 통해 실시간으로 주문을 수신하고 관리할 수 있습니다.

## 주요 기능

### 🍽️ 주문 관리
- **실시간 주문 수신**: RMS 서버로부터 WebSocket을 통해 실시간 주문 접수
- **주문 상세 정보 표시**: 주문 항목, 수량, 가격, 배송 위치 등 상세 정보 확인
- **준비완료 처리**: 주문 준비 완료 시 상태 변경 및 RMS 서버에 알림

### 🤖 로봇 연동
- **로봇 도착 알림**: 로봇이 픽업을 위해 도착했을 때 팝업 알림
- **실시간 상태 동기화**: RMS 서버와 실시간으로 상태 동기화

### 📊 모니터링
- **주문 현황 대시보드**: 신청품목과 준비완료 주문을 탭으로 구분하여 관리
- **로그 시스템**: 모든 통신 및 이벤트를 파일과 콘솔에 로그 기록

## 파일 구조

```
staff_gui/
├── README.md              # 프로젝트 문서
├── staff_app.py           # 메인 GUI 애플리케이션
├── config.py              # 서버 설정 및 환경 변수
└── test_rms.py            # 테스트용 RMS 서버 (스켈레톤)
```

## 기술 스택

- **GUI Framework**: Tkinter (Python 기본 GUI 라이브러리)
- **네트워크 통신**: WebSocket (실시간 통신), HTTP (상태 변경 요청)
- **비동기 처리**: asyncio, threading
- **로깅**: Python logging 모듈

## 설치 및 실행

### 1. 의존성 설치
```bash
pip install fastapi uvicorn websockets requests
```

### 2. 설정 파일 수정
`config.py`에서 RMS 서버 주소를 설정합니다:
```python
RMS_HOST = "192.168.0.47"  # RMS 서버 IP 주소
RMS_PORT = 8000            # RMS 서버 포트
```

### 3. 애플리케이션 실행
```bash
python staff_app.py
```

## 통신 프로토콜

### WebSocket 연결
- **URL**: `ws://{RMS_HOST}:{RMS_PORT}/api/gui/ws/staff/staff_01`
- **역할**: 실시간 이벤트 수신 (주문 생성, 로봇 도착 등)

### HTTP API
- **Base URL**: `http://{RMS_HOST}:{RMS_PORT}/api/gui`
- **엔드포인트**: `/food_order_status_change` (준비완료 상태 변경)

### 이벤트 타입

#### 1. 주문 생성 이벤트
```json
{
  "type": "event",
  "action": "food_order_creation",
  "payload": {
    "task_id": 1,
    "request_location": "ROOM_307",
    "order_details": {
      "items": [
        {
          "name": "스파게티",
          "quantity": 2,
          "price": 15000
        }
      ]
    }
  }
}
```

#### 2. 로봇 도착 이벤트
```json
{
  "type": "event",
  "action": "food_pickup_arrival",
  "payload": {
    "task_id": 1,
    "robot_id": "ROBOT_01"
  }
}
```

## 사용법

### 1. 주문 관리
1. **주문 접수**: RMS 서버에서 주문이 생성되면 자동으로 "신청품목" 탭에 표시
2. **주문 선택**: 왼쪽 목록에서 주문을 클릭하여 상세 정보 확인
3. **준비완료**: "준비완료" 버튼을 클릭하여 주문 상태 변경

### 2. 로봇 도착 알림
- 로봇이 픽업을 위해 도착하면 팝업 알림이 표시됩니다
- 알림에는 로봇 ID와 해당 주문 정보가 포함됩니다

### 3. 로그 확인
- 모든 통신 및 이벤트는 `staff_gui.log` 파일에 기록됩니다
- 콘솔에서도 실시간으로 로그를 확인할 수 있습니다

## 테스트

### 테스트용 RMS 서버 실행
```bash
python test_rms.py
```

### 테스트 기능
- **테스트 주문 생성**: `http://localhost:8000/send_test_order`
- **로봇 도착 시뮬레이션**: `http://localhost:8000/send_robot_arrival`
- **자동 주문 생성**: 30초마다 자동으로 테스트 주문 생성

## 개발 참고사항

### 스켈레톤 구조
이 프로젝트는 실제 RMS 서버와의 통신을 위해 임시로 만든 스켈레톤 구조입니다. 실제 운영 환경에서는 다음 사항들을 고려해야 합니다:

1. **에러 처리**: 네트워크 오류, 서버 다운 등의 상황에 대한 강화된 에러 처리
2. **보안**: 인증 및 권한 관리 시스템 추가
3. **성능**: 대량 주문 처리 시 성능 최적화
4. **UI/UX**: 사용자 경험 개선 및 접근성 고려

### 확장 가능한 기능
- **다중 직원 지원**: 여러 직원이 동시에 사용할 수 있는 구조
- **통계 및 리포트**: 주문 통계 및 성과 분석 기능
- **설정 관리**: 직원별 설정 및 환경 설정 기능

## 문제 해결

### 일반적인 문제들

1. **WebSocket 연결 실패**
   - RMS 서버가 실행 중인지 확인
   - `config.py`의 서버 주소가 올바른지 확인

2. **주문 정보가 표시되지 않음**
   - 로그 파일(`staff_gui.log`)에서 오류 메시지 확인
   - RMS 서버에서 보내는 데이터 구조 확인

3. **준비완료 처리 실패**
   - HTTP 요청이 올바른 엔드포인트로 전송되는지 확인
   - 서버 응답 코드 및 메시지 확인

## 라이선스

이 프로젝트는 내부 개발용으로 제작되었습니다.

## 기여

개발팀 내부에서만 사용되는 프로젝트입니다. 버그 리포트나 기능 요청은 개발팀에 직접 문의해주세요.
